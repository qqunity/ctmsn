# Fishing (4.14) ‚Äî –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

> **–ù–∞–≤–∏–≥–∞—Ü–∏—è:** [üè† –ì–ª–∞–≤–Ω–∞—è](README.md) | [‚Üê Time Process](TIME_PROCESS_IMPLEMENTATION.md) | **–í—ã –∑–¥–µ—Å—å: Fishing** | [–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí](USAGE.md)

## üìñ –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏](#–æ–ø–∏—Å–∞–Ω–∏–µ-–∑–∞–¥–∞—á–∏)
- [–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å](#–º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è-–º–æ–¥–µ–ª—å)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
- [–ê–ª–≥–æ—Ä–∏—Ç–º –≤—ã–≤–æ–¥–∞ –∫–æ–º–ø–æ–∑–∏—Ü–∏–π](#–∞–ª–≥–æ—Ä–∏—Ç–º-–≤—ã–≤–æ–¥–∞-–∫–æ–º–ø–æ–∑–∏—Ü–∏–π)
- [–ö–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞](#–∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–µ-—Ä–∞–≤–µ–Ω—Å—Ç–≤–∞)
- [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

> **–°–º. —Ç–∞–∫–∂–µ:**
> - [USAGE.md](USAGE.md) ‚Äî –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
> - [FORCING_IMPLEMENTATION.md](FORCING_IMPLEMENTATION.md) ‚Äî –¥–µ—Ç–∞–ª–∏ —Ñ–æ—Ä—Å–∏–Ω–≥-–¥–≤–∏–∂–∫–∞
> - [scenarios/fishing/README.md](src/ctmsn/scenarios/fishing/README.md) ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è

## –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏

–ó–∞–¥–∞—á–∞ –æ —Ä—ã–±–∞–ª–∫–µ (4.14) –º–æ–¥–µ–ª–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å "–ø–æ–π–º–∞—Ç—å —Ä—ã–±—É" —á–µ—Ä–µ–∑ –∫—Ä—é—á–æ–∫ –∏ –Ω–∞–∂–∏–≤–∫—É. –ö–ª—é—á–µ–≤–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å –∑–∞–¥–∞—á–∏ ‚Äî —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ä—ã–± –Ω–∞ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –∏ –ø–æ–π–º–∞–Ω–Ω—ã—Ö, —á–µ—Ä–≤–µ–π –Ω–∞ –Ω–∞—Å—Ç–æ—è—â–∏—Ö –∏ —Ñ–∞–ª—å—à–∏–≤—ã—Ö, —Å –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ–º –¥–ª–∏–Ω–Ω–æ–π –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –∏–∑ 4 —à–∞–≥–æ–≤.

### –°—É—â–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–∏

**–°–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞:**
- `A`, `B` ‚Äî —ç—Ç–∞–ø—ã/—Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–æ–±—ã—Ç–∏—è

**–†—ã–±—ã:**
- `F` ‚Äî –º–Ω–æ–∂–µ—Å—Ç–≤–æ –≤—Å–µ—Ö —Ä—ã–±
- `F_plus` (F‚Å∫) ‚Äî –ø–æ–π–º–∞–Ω–Ω—ã–µ —Ä—ã–±—ã (—É–ª–æ–≤)
- `F_minus` (F‚Åª) ‚Äî —Å–≤–æ–±–æ–¥–Ω—ã–µ —Ä—ã–±—ã
- –ö–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏: `F_minus = F \ F_plus`

**–ß–µ—Ä–≤–∏:**
- `W` ‚Äî —á–µ—Ä–≤–∏
- `W_plus` (W‚Å∫) ‚Äî —Ñ–∞–ª—å—à–∏–≤—ã–µ —á–µ—Ä–≤–∏ (–Ω–∞–∂–∏–≤–∫–∞)

**–ö–æ–Ω—Ç–µ–∫—Å—Ç—ã:**
- `Cf_minus` (C_f‚Åª) ‚Äî –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Ä—ã–± (–µ–¥—è—Ç –Ω–∞—Å—Ç–æ—è—â–∏—Ö —á–µ—Ä–≤–µ–π)
- `Cf_plus` (C_f‚Å∫) ‚Äî –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–π–º–∞–Ω–Ω—ã—Ö —Ä—ã–± (–Ω–∞ –Ω–∞–∂–∏–≤–∫–µ)

## –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å

### –î–∏–∞–≥—Ä–∞–º–º–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π

```
       f
    B ‚îÄ‚îÄ‚îÄ‚Üí A
    ‚îÇ      ‚îÇ
 sf ‚îÇ      ‚îÇ h (–ø—É–Ω–∫—Ç–∏—Ä)
    ‚îÇ      ‚Üì
    ‚Üì      F
  C_f‚Åª  ‚Üô  ‚Üì  ‚Üò
    ‚îÇ  s   ‚îÇ   j
    ‚îÇ      ‚Üì    ‚Üì
    ‚îÇ    F‚Åª ‚Üí  F‚Å∫
    ‚îÇ       catch
    ‚îÇ
    ‚îÇ eat
    ‚Üì
    W ‚îÄ‚îÄ‚Üí W‚Å∫
      fake+
    
    W‚Å∫ ‚îÄ‚îÄ‚Üí C_f‚Å∫
      hook+
```

### –ú–æ—Ä—Ñ–∏–∑–º—ã (—Å—Ç—Ä–µ–ª–∫–∏)

**–ë–∞–∑–æ–≤—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è:**
- `f: B ‚Üí A` ‚Äî —Ä–∞–∑–≤–∏—Ç–∏–µ —Å–æ–±—ã—Ç–∏—è
- `h: A ‚Üí F` ‚Äî "—Ä—ã–±–∫–∞" (–æ–±—â–∏–π –º–æ—Ä—Ñ–∏–∑–º)
- `s: A ‚Üí F_minus` ‚Äî "—Å–≤–æ–±–æ–¥–Ω–∞—è —Ä—ã–±–∞"
- `j: A ‚Üí F_plus` ‚Äî "–ø–æ–π–º–∞–Ω–Ω–∞—è —Ä—ã–±–∞"

**–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ:**
- `g_minus: F ‚Üí F_minus` ‚Äî –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Ä—ã–±
- `g_plus: F ‚Üí F_plus` ‚Äî –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–æ–π–º–∞–Ω–Ω—ã—Ö —Ä—ã–±

**–ü—Ä–æ—Ü–µ—Å—Å –ª–æ–≤–ª–∏:**
- `catch: F_minus ‚Üí F_plus` ‚Äî –ø–æ–π–º–∞—Ç—å —Ä—ã–±—É (–æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å)
- `sf: B ‚Üí Cf_minus` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Ä—ã–±

**–ö–æ–Ω—Ç–µ–∫—Å—Ç—ã –∏ –≤–∫–ª—é—á–µ–Ω–∏—è:**
- `incl: Cf_minus ‚Üí F_minus` ‚Äî –≤–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å–≤–æ–±–æ–¥–Ω—ã—Ö
- `incl: Cf_plus ‚Üí F_plus` ‚Äî –≤–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ–π–º–∞–Ω–Ω—ã—Ö

**–ü—Ä–æ—Ü–µ—Å—Å —Å —á–µ—Ä–≤—è–º–∏:**
- `eat: Cf_minus ‚Üí W` ‚Äî —Ä—ã–±—ã –µ–¥—è—Ç —á–µ—Ä–≤–µ–π
- `fake_plus: W ‚Üí W_plus` ‚Äî —Ñ–∞–ª—å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–≤—è (—Å–æ–∑–¥–∞–Ω–∏–µ –Ω–∞–∂–∏–≤–∫–∏)
- `fake_minus: W ‚Üí W` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏
- `hook_minus: W ‚Üí Cf_minus` ‚Äî –Ω–∞—Å—Ç–æ—è—â–∏–π —á–µ—Ä–≤—å –≤ —Å–≤–æ–±–æ–¥–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
- `hook_plus: W_plus ‚Üí Cf_plus` ‚Äî –Ω–∞–∂–∏–≤–∫–∞ –Ω–∞ –∫—Ä—é—á–∫–µ

**–†–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–∞—è —Å—Ç—Ä–µ–ª–∫–∞:**
- `catch_sf: B ‚Üí Cf_plus` ‚Äî –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª–∏–Ω–Ω–æ–π –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ü—Ä–∏–Ω—Ü–∏–ø—ã –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–ú–æ–¥–µ–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –≥—Ä–∞—Ñ** ‚Äî –≤ `model.py` —Ç–æ–ª—å–∫–æ `edge(...)`, –±–µ–∑ `comp(...)`
2. **–ö–æ–º–ø–æ–∑–∏—Ü–∏–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è** ‚Äî –≤ `derive.py` —á–µ—Ä–µ–∑ –∞–Ω–∞–ª–∏–∑ –ø—É—Ç–µ–π
3. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è** ‚Äî –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —É–∑–ª—ã
4. **–ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è** ‚Äî –¥–ª–∏–Ω–Ω—ã–µ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ —Å–æ–∑–¥–∞—é—Ç `derived_edge` –¥–ª—è —Ñ–æ—Ä—Å–∏–Ω–≥–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª–µ–π

```
scenarios/fishing/
‚îú‚îÄ‚îÄ __init__.py         # –ü—É—Å—Ç–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä
‚îú‚îÄ‚îÄ model.py            # –ì—Ä–∞—Ñ: —Ç–æ–ª—å–∫–æ edge + set —Ñ–∞–∫—Ç—ã
‚îú‚îÄ‚îÄ derive.py           # –í—ã–≤–æ–¥ comp2 –∏ compN —Å trace
‚îú‚îÄ‚îÄ params.py           # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–ø–æ–∫–∞ –ø—É—Å—Ç–æ)
‚îú‚îÄ‚îÄ constraints.py      # –£—Å–ª–æ–≤–∏—è: —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞ –∏–∑ –ø–æ–¥–ø–∏—Å–∏
‚îú‚îÄ‚îÄ goal.py             # –¶–µ–ª—å: —Ç–µ –∂–µ —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞ –∫–∞–∫ —Ñ–æ—Ä–º—É–ª–∞
‚îú‚îÄ‚îÄ explain.py          # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤
‚îú‚îÄ‚îÄ runner.py           # –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª: build‚Üíderive‚Üícheck‚Üíforce
‚îî‚îÄ‚îÄ README.md           # –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
```

## –ê–ª–≥–æ—Ä–∏—Ç–º –≤—ã–≤–æ–¥–∞ –∫–æ–º–ø–æ–∑–∏—Ü–∏–π

### –í—ã–≤–æ–¥ 2-—à–∞–≥–æ–≤—ã—Ö –∫–æ–º–ø–æ–∑–∏—Ü–∏–π (comp2)

```python
def derive_comp2(net: SemanticNetwork) -> int:
    """
    –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—É—Ç–∏ X -left-> mid -right-> Z:
    –ï—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–º–µ–Ω–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞ X -result-> Z,
    —Ç–æ comp2(left, right, result) i.e. right ‚àò left = result
    """
    # 1. –°–æ–±—Ä–∞—Ç—å –≤—Å–µ —Å—Ç—Ä–µ–ª–∫–∏
    edges = all_edges(net)  # edge + derived_edge
    
    # 2. –ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ø–æ –ø–∞—Ä–µ (src, dst) -> [labels]
    by_pair = index_by_endpoints(edges)
    
    # 3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ 2-—à–∞–≥–æ–≤–æ–≥–æ –ø—É—Ç–∏
    for (left, X, mid) in edges:
        for (right, mid2, Z) in edges:
            if mid != mid2:
                continue
            
            # 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–µ–π —Å—Ç—Ä–µ–ª–∫–∏
            for result in by_pair[(X, Z)]:
                # –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ
                net.assert_fact("comp2", (left, right, result))
                net.assert_fact("comp2_expl", (left, right, result, mid))
```

**–ü—Ä–∏–º–µ—Ä:**
- –ü—É—Ç—å: `A -h-> F -g_minus-> F_minus`
- –†–µ–∑—É–ª—å—Ç–∞—Ç: `A -s-> F_minus`
- –í—ã–≤–æ–¥: `comp2("h", "g_minus", "s")` —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º `mid=F`

### –í—ã–≤–æ–¥ N-—à–∞–≥–æ–≤—ã—Ö –∫–æ–º–ø–æ–∑–∏—Ü–∏–π (compN)

```python
def derive_compN(net, start, chain, result_label, chain_name=None) -> bool:
    """
    –î–ª—è —Ü–µ–ø–æ—á–∫–∏ –º–µ—Ç–æ–∫ [label1, label2, ..., labelN]:
    1. –°–ª–µ–¥–æ–≤–∞—Ç—å –ø–æ –ø—É—Ç–∏ –æ—Ç start
    2. –ï—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç end, –∏ –µ—Å—Ç—å edge(result_label, start, end)
    3. –¢–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å compN(chain_name, result_label)
    4. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Å–æ–∑–¥–∞—Ç—å derived_edge(chain_name, start, end)
    """
    # 1. –°–ª–µ–¥–æ–≤–∞—Ç—å –ø–æ —Ü–µ–ø–æ—á–∫–µ
    ok, ends, trace = follow_chain(net, start, chain)
    
    if not ok:
        return False
    
    # 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–µ–π —Å—Ç—Ä–µ–ª–∫–∏
    for end in ends:
        if exists_edge(result_label, start, end):
            # 3. –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ
            net.assert_fact("compN", (chain_name, result_label))
            net.assert_fact("compN_expl", (chain_name, result_label, trace))
            
            # 4. –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–∞–∫ —Å—Ç—Ä–µ–ª–∫—É
            if chain_name and len(ends) == 1:
                net.assert_fact("derived_edge", (chain_name, start, end))
            
            return True
    
    return False
```

**–ü—Ä–∏–º–µ—Ä –¥–ª—è –¥–ª–∏–Ω–Ω–æ–π –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏:**
```python
derive_compN(
    net=net,
    start="B",
    chain=["sf", "eat", "fake_plus", "hook_plus"],
    result_label="catch_sf",
    chain_name="hook+‚àòfake+‚àòeat‚àòsf"
)
```

**Trace:**
```
sf: ['Cf_minus']
eat: ['W']
fake_plus: ['W_plus']
hook_plus: ['Cf_plus']
end=Cf_plus
```

## –ö–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞

### 1. –†–∞–∑–Ω–æ—Å—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤

```
F_minus = F \ F_plus
```

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑:
```python
net.assert_fact("subset", (Fp, F))
net.assert_fact("subset", (Fm, F))
net.assert_fact("diff", (Fm, F, Fp))
```

### 2. –ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞ (2-—à–∞–≥–æ–≤—ã–µ)

**–†–∞–≤–µ–Ω—Å—Ç–≤–æ 1:** `g_minus ‚àò h = s`
```
A --h--> F --g_minus--> F_minus
A --s--> F_minus

–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ: comp2("h", "g_minus", "s") —á–µ—Ä–µ–∑ —É–∑–µ–ª F
```

**–†–∞–≤–µ–Ω—Å—Ç–≤–æ 2:** `g_plus ‚àò h = j`
```
A --h--> F --g_plus--> F_plus
A --j--> F_plus

–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ: comp2("h", "g_plus", "j") —á–µ—Ä–µ–∑ —É–∑–µ–ª F
```

**–†–∞–≤–µ–Ω—Å—Ç–≤–æ 3:** `catch ‚àò s = j`
```
A --s--> F_minus --catch--> F_plus
A --j--> F_plus

–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ: comp2("s", "catch", "j") —á–µ—Ä–µ–∑ —É–∑–µ–ª F_minus
```

### 3. –î–ª–∏–Ω–Ω–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è (4 —à–∞–≥–∞)

**–†–∞–≤–µ–Ω—Å—Ç–≤–æ:** `hook_plus ‚àò fake_plus ‚àò eat ‚àò sf = catch_sf`

```
B --sf--> Cf_minus --eat--> W --fake_plus--> W_plus --hook_plus--> Cf_plus
B --catch_sf--> Cf_plus

–ü—É—Ç—å (–ø—Ä—è–º–∞—è –Ω–æ—Ç–∞—Ü–∏—è):
  sf: B ‚Üí Cf_minus
  eat: Cf_minus ‚Üí W
  fake_plus: W ‚Üí W_plus
  hook_plus: W_plus ‚Üí Cf_plus
  
–†–µ–∑—É–ª—å—Ç–∞—Ç: B ‚Üí Cf_plus (–∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π –∫–∞–∫ catch_sf)
```

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:**
"–†—ã–±–∞ —Å—ä–µ–ª–∞ –Ω–∞–∂–∏–≤–∫—É –∏ –ø–æ–ø–∞–ª–∞—Å—å –Ω–∞ –∫—Ä—é—á–æ–∫" ‚â° "–ü—Ä–æ—Ü–µ—Å—Å –ø—Ä–∏–≤—ë–ª –∫ —É–ª–æ–≤—É"

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë–∞–∑–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π

```python
from ctmsn.scenarios.fishing.runner import run

out = run()

print("Derivation:", out["derivation"])
print("Check ok:", out["check"].ok)
print("forces(phi):", out["forces"].value)
print("force(phi):", out["result"].status.value)

for line in out["explain"]:
    print("  -", line)
```

**–í—ã–≤–æ–¥:**
```
Derivation: {'comp2_added': 18, 'compN_long_ok': True}
Check ok: True
forces(phi): true
force(phi): true | Already forced

Explain:
  - s = g_minus ‚àò h (—á–µ—Ä–µ–∑ F)
  - j = g_plus ‚àò h (—á–µ—Ä–µ–∑ F)
  - j = catch ‚àò s (—á–µ—Ä–µ–∑ F_minus)
  - catch_sf = hook+‚àòfake+‚àòeat‚àòsf (trace: sf: ['Cf_minus']; ...)
```

### –ü–æ—à–∞–≥–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑

```python
from ctmsn.scenarios.fishing.model import build_network
from ctmsn.scenarios.fishing.derive import apply

net = build_network()
stats = apply(net)

print("–í—ã–≤–µ–¥–µ–Ω–æ –∫–æ–º–ø–æ–∑–∏—Ü–∏–π:", stats["comp2_added"])
print("–î–ª–∏–Ω–Ω–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è OK:", stats["compN_long_ok"])

comp2_facts = list(net.facts("comp2"))
for st in comp2_facts:
    left, right, result = st.args
    print(f"{result} = {right} ‚àò {left}")
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞

```python
from ctmsn.param.context import Context
from ctmsn.forcing.engine import ForcingEngine
from ctmsn.logic.formula import FactAtom

net = build_network()
apply(net)

eng = ForcingEngine(net)
ctx = Context()

phi = FactAtom("comp2", ("s", "catch", "j"))
result = eng.forces(ctx, phi)

print(f"catch ‚àò s = j: {result.value}")
```

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –û—Ç–ª–∏—á–∏—è –æ—Ç fast_smith

**Fast Smith:**
- –ü—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞: 1 –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è, 1 –¥–æ–º–µ–Ω
- –ö–æ–º–ø–æ–∑–∏—Ü–∏–∏ —è–≤–Ω–æ –∑–∞–¥–∞–Ω—ã –≤ –º–æ–¥–µ–ª–∏
- –ö–æ—Ä–æ—Ç–∫–∏–µ 2-—à–∞–≥–æ–≤—ã–µ —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞

**Fishing:**
- –°–ª–æ–∂–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞: 9 —É–∑–ª–æ–≤, –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è
- –ö–æ–º–ø–æ–∑–∏—Ü–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤—ã–≤–æ–¥—è—Ç—Å—è
- –î–ª–∏–Ω–Ω–∞—è 4-—à–∞–≥–æ–≤–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è —Å –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π

### –û—Ç–ª–∏—á–∏—è –æ—Ç time_process

**Time Process:**
- –§–æ–∫—É—Å –Ω–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–æ –≤—Ä–µ–º–µ–Ω–∏
- –í—ã–≤–æ–¥ —Ç—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π (before/after)
- –û–±—ä—è—Å–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∏

**Fishing:**
- –§–æ–∫—É—Å –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞—Ö
- –í—ã–≤–æ–¥ –∫–æ–º–ø–æ–∑–∏—Ü–∏–π —á–µ—Ä–µ–∑ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- –û–±—ä—è—Å–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —É–∑–ª—ã

### –ö–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ß–∏—Å—Ç–∞—è –º–æ–¥–µ–ª—å** ‚Äî —Ç–æ–ª—å–∫–æ –¥–∏–∞–≥—Ä–∞–º–º–∞, –±–µ–∑ "–º–∞–≥–∏–∏"
2. **–ü–æ–ª–Ω–∞—è –≤—ã–≤–æ–¥–∏–º–æ—Å—Ç—å** ‚Äî –≤—Å–µ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –¥–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è
3. **Trace –¥–ª—è –æ–±—É—á–µ–Ω–∏—è** ‚Äî –∫–∞–∂–¥–æ–µ —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º
4. **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** ‚Äî –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏
5. **–§–æ—Ä—Å–∏–Ω–≥-–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å** ‚Äî –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä–µ–ª–∫–∏ –¥–ª—è force()

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å—Ç—Ä–µ–ª–æ–∫

–î–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø—É—Ç–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è:

```python
by_pair: Dict[Tuple[str, str], List[str]]
# (src_id, dst_id) -> [labels]

# –ü—Ä–∏–º–µ—Ä:
# ("A", "F_minus") -> ["s"]
# ("A", "F_plus") -> ["j"]
```

### –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—É—Ç–µ–π

```python
adj: Dict[Tuple[str, str], List[str]]
# (src_id, label) -> [dst_ids]

# –ü—Ä–∏–º–µ—Ä —à–∞–≥–∞ —Ü–µ–ø–æ—á–∫–∏:
# ("B", "sf") -> ["Cf_minus"]
# ("Cf_minus", "eat") -> ["W"]
```

### –§–æ—Ä–º–∞—Ç—ã —Ñ–∞–∫—Ç–æ–≤

**–ë–∞–∑–æ–≤—ã–π –≥—Ä–∞—Ñ:**
```python
edge(label: str, from: Concept, to: Concept)
```

**–í—ã–≤–µ–¥–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏:**
```python
comp2(left: str, right: str, result: str)
comp2_expl(left: str, right: str, result: str, mid: str)

compN(chain: str, result: str)
compN_expl(chain: str, result: str, trace: str)

derived_edge(label: str, from: Concept, to: Concept)
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç—ã –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è

```python
def test_builds():
    net = build_network()
    assert len(net.concepts) == 9
    assert "catch_sf" in edge_labels(net)
```

### –¢–µ—Å—Ç—ã –≤—ã–≤–æ–¥–∞

```python
def test_derive_comp2():
    net = build_network()
    apply(net)
    
    comp2_set = {(left, right, result) for ...}
    assert ("h", "g_minus", "s") in comp2_set
    assert ("h", "g_plus", "j") in comp2_set
    assert ("s", "catch", "j") in comp2_set
```

### –¢–µ—Å—Ç—ã —Ü–µ–ª–µ–π

```python
def test_forces_goal():
    net = build_network()
    apply(net)
    
    phi = build_goal()
    conds = build_conditions()
    
    result = eng.forces(ctx, phi, conds)
    assert result.value == "true"
```

## –ë—É–¥—É—â–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

- –í—ã–≤–æ–¥ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–∑–∏—Ü–∏–π (—á–µ—Ä–µ–∑ –≤–∫–ª—é—á–µ–Ω–∏—è `incl`)
- –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ–∏—Å–∫–∞ –ø—É—Ç–µ–π (shortest path, all paths)
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∏–∞–≥—Ä–∞–º–º—ã –∏ –ø—É—Ç–µ–π
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤
- –§–æ—Ä—Å–∏–Ω–≥ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Å—Ç—Ä–µ–ª–æ–∫ —á–µ—Ä–µ–∑ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏

---

> **–ù–∞–≤–∏–≥–∞—Ü–∏—è:** [üè† –ì–ª–∞–≤–Ω–∞—è](README.md) | [‚Üê Time Process](TIME_PROCESS_IMPLEMENTATION.md) | **–í—ã –∑–¥–µ—Å—å: Fishing** | [–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí](USAGE.md)
