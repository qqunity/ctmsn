# CTNSS - Cursor Rules

## Общие правила проекта

Это библиотека для работы с семантическими сетями, параметризацией и форсингом.
Код должен быть чистым, типизированным и следовать принципам иммутабельности.

## Технологии и версии

- Python 3.9+
- Без внешних зависимостей
- Использование стандартной библиотеки Python

## Стиль кодирования

### Импорты
- Всегда используй `from __future__ import annotations` в начале файла
- Группируй импорты: стандартная библиотека → внешние библиотеки → локальные импорты
- Используй абсолютные импорты для модулей внутри ctnss

### Типизация
- Используй аннотации типов для всех функций и методов
- Используй современный синтаксис типов: `list[T]`, `dict[K, V]`, `str | None` вместо `Optional[str]`
- Для frozen dataclass используй `FrozenSet` вместо `set`
- Для иммутабельных маппингов используй `Mapping` вместо `dict`

### Классы и структуры данных
- Используй `@dataclass(frozen=True)` для иммутабельных структур данных
- Используй `field(default_factory=...)` для коллекций по умолчанию
- Реализуй `__hash__` для классов, которые могут быть ключами
- Для создания модифицированных копий используй методы `with_*`

### Логика и вычисления
- Используй `TriBool` для трехзначной логики (TRUE/FALSE/UNKNOWN)
- Не приводи `TriBool` к `bool` напрямую
- Используй явные проверки: `result == TriBool.TRUE`

### Именование
- Классы: `PascalCase`
- Функции и методы: `snake_case`
- Константы: `UPPER_SNAKE_CASE`
- Приватные атрибуты: `_leading_underscore`
- ID концептов: `lowercase_snake_case`

## Архитектура модулей

### core/
Базовые структуры семантической сети:
- `Concept` - неизменяемые концепты с id, label, tags, meta
- `Predicate` - предикаты с арностью
- `Statement` - факты в сети
- `SemanticNetwork` - контейнер для концептов, предикатов и фактов

### param/
Параметризация и контексты:
- `Domain` - домены значений (EnumDomain, PredicateDomain)
- `Variable` - переменные с доменами
- `Context` - частичное присваивание значений переменным

### logic/
Логический слой:
- `Formula` - абстрактные формулы
- `FactAtom`, `Not`, `And`, `Or`, `Implies` - конкретные формулы
- `Term` - термы (ConstTerm, VarTerm)
- `Evaluator` - вычисление истинности формул

### forcing/
Форсинг-движок:
- `ForcingEngine` - основной движок для проверки и расширения контекстов
- `Conditions` - условия и ограничения
- `ForcingResult` - результат с explanation
- `Strategy` - стратегии поиска (пока не реализовано)

### io/
Сериализация и десериализация:
- JSON-совместимые форматы
- Читаемые представления для отладки

## Правила разработки

### При добавлении нового функционала:
1. Сохраняй иммутабельность структур данных
2. Добавляй типизацию для всех публичных API
3. Используй паттерн `with_*` для модификаций
4. Документируй сложную логику в docstrings
5. Пиши примеры использования в `examples/`

### При изменении существующего кода:
1. Не нарушай обратную совместимость
2. Сохраняй существующий стиль кодирования
3. Обновляй связанные примеры в `examples/`
4. Проверяй корректность типов

### Тестирование:
- Тесты в директории `tests/`
- Используй простые assert для проверок
- Тестируй граничные случаи (пустые сети, неопределенные значения)
- Проверяй все три состояния TriBool

### Примеры:
- Помещай примеры в `src/ctnss/examples/`
- Делай примеры самодостаточными
- Комментируй ключевые моменты для обучения
- Показывай типичные сценарии использования

## Запрещенные практики

- Не используй mutable значения по умолчанию
- Не модифицируй объекты напрямую (используй with_* методы)
- Не приводи TriBool к bool
- Не используй глобальное состояние
- Не добавляй внешние зависимости без необходимости
- Не пиши комментарии к очевидному коду

## Команды для разработки

```bash
source venv/bin/activate

python src/ctnss/examples/hello_forcing.py

python src/ctnss/examples/example_usage.py

python tests/test_smoke_imports.py
```

## Будущие направления

- Реализация стратегий поиска в forcing/strategy.py
- Механизм объяснений (explainability)
- Кванторы в логическом слое
- Полноценная сериализация
- Комплексные тесты
